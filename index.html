<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SINYA Annual P&L Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="topbar">
    <h1>SINYA Annual P&amp;L Dashboard</h1>
    <div class="actions">
      <label class="file-btn">
        載入 CSV
        <input type="file" id="fileInput" accept=".csv">
      </label>
      <input id="sheetUrl" type="url" placeholder="貼上 Google Sheet 的 CSV 連結（Publish to web）">
      <button id="loadUrlBtn">從連結載入</button>
      <button id="downloadAnomsBtn">匯出異常清單 CSV</button>
      <a class="gh-btn" href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages 指南</a>
    </div>
  </header>

  <main class="container">
    <section class="panel">
      <div class="row">
        <div class="col">
          <label>情境（Scenario）</label>
          <select id="scenarioSelect">
            <option value="1.00">Base（1.00x）</option>
            <option value="1.08">Optimistic（1.08x）</option>
            <option value="0.92">Conservative（0.92x）</option>
          </select>
        </div>
        <div class="col">
          <label>快速搜尋</label>
          <input id="searchBox" type="search" placeholder="輸入關鍵字（Category/Brand/Owner）">
        </div>
      </div>
      <div id="kpis" class="kpi-grid">
        <div class="kpi"><div class="kpi-label">2025 營業額合計</div><div class="kpi-value" id="kpiSales2025">—</div></div>
        <div class="kpi"><div class="kpi-label">2025 毛利額合計</div><div class="kpi-value" id="kpiGP2025">—</div></div>
        <div class="kpi"><div class="kpi-label">2026 營業額（情境）</div><div class="kpi-value" id="kpiSales2026">—</div></div>
        <div class="kpi"><div class="kpi-label">2026 毛利額（情境）</div><div class="kpi-value" id="kpiGP2026">—</div></div>
        <div class="kpi"><div class="kpi-label">營收 YoY</div><div class="kpi-value" id="kpiSalesYoY">—</div></div>
        <div class="kpi"><div class="kpi-label">毛利 YoY</div><div class="kpi-value" id="kpiGPYoY">—</div></div>
      </div>
    </section>

    <section class="panel">
      <h2>資料總表</h2>
      <div class="table-wrap">
        <table id="dataTable">
          <thead>
            <tr>
              <th data-key="Category">Category</th>
              <th data-key="Brand">Brand</th>
              <th data-key="Owner">Owner</th>
              <th data-key="YearSales_2025" class="num">YearSales_2025</th>
              <th data-key="YearGP_2025" class="num">YearGP_2025</th>
              <th data-key="MonthSales_2025" class="num">MonthSales_2025</th>
              <th data-key="MonthGP_2025" class="num">MonthGP_2025</th>
              <th data-key="SalesGrowth_2026%" class="num">SalesGrowth_2026%</th>
              <th data-key="GPGrowth_2026%" class="num">GPGrowth_2026%</th>
              <th data-key="Notes">Notes</th>
              <th class="num">GPMargin_2025</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="hint">欄位需求（CSV 標頭請一致）：Category, Brand, Owner, YearSales_2025, YearGP_2025, MonthSales_2025, MonthGP_2025, SalesGrowth_2026%, GPGrowth_2026%, Notes</p>
    </section>

    <section class="panel">
      <h2>異常清單（自動偵測）</h2>
      <ul class="bullets">
        <li>YearSales_2025 = 0 且 YearGP_2025 &gt; 0（分母為 0）</li>
        <li>YearGP_2025 &lt; 0（負毛利）</li>
        <li>GPMargin_2025 &gt; 60%（可能異常高）</li>
      </ul>
      <div class="table-wrap">
        <table id="anomTable">
          <thead>
            <tr>
              <th>Category</th><th>Brand</th><th>Owner</th>
              <th class="num">YearSales_2025</th><th class="num">YearGP_2025</th>
              <th class="num">GPMargin_2025</th>
              <th class="num">SalesGrowth_2026%</th><th class="num">GPGrowth_2026%</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>© 2025 SINYA Dashboard • 用 CSV 更新即可在 GitHub Pages 即時呈現</span>
  </footer>

  <script src="app.js"></script>
</body>
</html>
